"use strict";(self.webpackChunkapify_docs_v2=self.webpackChunkapify_docs_v2||[]).push([[5636],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>f});var r=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=r.createContext({}),c=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return r.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=c(n),f=o,h=d["".concat(s,".").concat(f)]||d[f]||u[f]||a;return n?r.createElement(h,i(i({ref:t},p),{},{components:n})):r.createElement(h,i({ref:t},p))}));function f(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var c=2;c<a;c++)i[c]=n[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},59996:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>f,frontMatter:()=>l,metadata:()=>c,toc:()=>u});var r=n(87462),o=n(63366),a=(n(67294),n(3905)),i=["components"],l={title:"Dockerfile",description:"Understand how to write a Dockerfile (Docker image blueprint) for your project so that it can be run within a Docker container on the Apify platform.",sidebar_position:3,slug:"/deploying-your-code/docker-file"},s="[](#dockerfile) Dockerfile",c={unversionedId:"deploying_your_code/docker_file",id:"deploying_your_code/docker_file",title:"Dockerfile",description:"Understand how to write a Dockerfile (Docker image blueprint) for your project so that it can be run within a Docker container on the Apify platform.",source:"@site/sources/academy/deploying_your_code/docker_file.md",sourceDirName:"deploying_your_code",slug:"/deploying-your-code/docker-file",permalink:"/academy/deploying-your-code/docker-file",draft:!1,tags:[],version:"current",lastUpdatedBy:"Jind\u0159ich B\xe4r",lastUpdatedAt:1672923705,formattedLastUpdatedAt:"Jan 5, 2023",sidebarPosition:3,frontMatter:{title:"Dockerfile",description:"Understand how to write a Dockerfile (Docker image blueprint) for your project so that it can be run within a Docker container on the Apify platform.",sidebar_position:3,slug:"/deploying-your-code/docker-file"},sidebar:"defaultSidebar",previous:{title:"Input schema",permalink:"/academy/deploying-your-code/input-schema"},next:{title:"Deploying",permalink:"/academy/deploying-your-code/deploying"}},p={},u=[{value:" Base images",id:"-base-images",level:2},{value:" Writing the file",id:"-writing-the-file",level:2},{value:" Examples",id:"-examples",level:2},{value:" Next up",id:"-next-up",level:2}],d={toc:u};function f(e){var t=e.components,n=(0,o.Z)(e,i);return(0,a.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"-dockerfile"},(0,a.kt)("a",{parentName:"h1",href:"#dockerfile",target:null,rel:null})," Dockerfile"),(0,a.kt)("p",null,"The ",(0,a.kt)("strong",{parentName:"p"},"Dockerfile")," is a file which gives the Apify platform (or Docker, more specifically) instructions on how to create an environment for your code to run in. Every actor must have a Dockerfile, as actors run in Docker containers."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Actors on the platform are always run in Docker containers; however, they can also be run in local Docker containers. This is not common practice though, as it requires more setup and a deeper understanding of Docker. For testing, it's best to just run the actor on the local OS (this requires you to have the underlying runtime installed, such as Node.js, Python, Rust, GO, etc).")),(0,a.kt)("h2",{id:"-base-images"},(0,a.kt)("a",{parentName:"h2",href:"#base-images",target:null,rel:null})," Base images"),(0,a.kt)("p",null,"If your project doesn\u2019t already contain a Dockerfile, don\u2019t worry! Apify offers ",(0,a.kt)("a",{parentName:"p",href:"https://sdk.apify.com/docs/guides/docker-images",target:null,rel:null},"many base images")," that are optimized for building and running actors on the platform, which can be found ",(0,a.kt)("a",{parentName:"p",href:"https://hub.docker.com/u/apify",target:"_blank",rel:"noopener"},"here"),". When using a language for which Apify doesn't provide a base image, ",(0,a.kt)("a",{parentName:"p",href:"https://hub.docker.com/",target:"_blank",rel:"noopener"},"Docker Hub")," provides a ton of free Docker images for most use-cases, upon which you can create your own images."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Tip: You can see all of Apify's Docker images ",(0,a.kt)("a",{parentName:"p",href:"https://hub.docker.com/r/apify/",target:"_blank",rel:"noopener"},"on DockerHub"),".")),(0,a.kt)("p",null,"At the base level, each Docker image contains a base operating system and usually also a programming language runtime (such as Node.js or Python). You can also find images with preinstalled libraries or just install them yourself during the build step."),(0,a.kt)("p",null,"Once you find the base image you need, you can add it as the initial ",(0,a.kt)("inlineCode",{parentName:"p"},"FROM")," statement:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-Dockerfile"},"FROM apify/actor-node:16\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"For syntax highlighting in your Dockerfiles, download the ",(0,a.kt)("a",{parentName:"p",href:"https://code.visualstudio.com/docs/containers/overview#_installation",target:"_blank",rel:"noopener"},(0,a.kt)("strong",{parentName:"a"},"Docker")," VSCode extension"),".")),(0,a.kt)("h2",{id:"-writing-the-file"},(0,a.kt)("a",{parentName:"h2",href:"#writing-the-file",target:null,rel:null})," Writing the file"),(0,a.kt)("p",null,"The rest of the Dockerfile is about copying the source code from the local filesystem into the container's filesystem, installing libraries, and setting the ",(0,a.kt)("inlineCode",{parentName:"p"},"RUN")," command (which falls back to the parent image)."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"If you are not using a base image from Apify, then you should specify how to launch the source code of your actor with the ",(0,a.kt)("inlineCode",{parentName:"p"},"CMD")," instruction.")),(0,a.kt)("p",null,"Here's the Dockerfile for our Node.js example project's actor:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-marked-tabs"},'<marked-tab header="Node.js Dockerfile" lang="Dockerfile">\nFROM apify/actor-node:16\n\n# Second, copy just package.json and package-lock.json since they are the only files\n# that affect NPM install in the next step\nCOPY package*.json ./\n\n# Install NPM packages, skip optional and development dependencies to keep the\n# image small. Avoid logging too much and print the dependency tree for debugging\nRUN npm --quiet set progress=false \\\n && npm install --only=prod --no-optional \\\n && echo "Installed NPM packages:" \\\n && (npm list --all || true) \\\n && echo "Node.js version:" \\\n && node --version \\\n && echo "NPM version:" \\\n && npm --version\n\n# Next, copy the remaining files and directories with the source code.\n# Since we do this after NPM install, quick build will be really fast\n# for simple source file changes.\nCOPY . ./\n</marked-tab>\n<marked-tab header="Python Dockerfile" lang="Dockerfile">\n# First, specify the base Docker image.\n# You can also use any other image from Docker Hub.\nFROM apify/actor-python:3.9\n\n# Second, copy just requirements.txt into the actor image,\n# since it should be the only file that affects "pip install" in the next step,\n# in order to speed up the build\nCOPY requirements.txt ./\n\n# Install the packages specified in requirements.txt,\n# Print the installed Python version, pip version\n# and all installed packages with their versions for debugging\nRUN echo "Python version:" \\\n && python --version \\\n && echo "Pip version:" \\\n && pip --version \\\n && echo "Installing dependencies from requirements.txt:" \\\n && pip install -r requirements.txt \\\n && echo "All installed Python packages:" \\\n && pip freeze\n\n# Next, copy the remaining files and directories with the source code.\n# Since we do this after installing the dependencies, quick build will be really fast\n# for most source file changes.\nCOPY . ./\n\n# Specify how to launch the source code of your actor.\n# By default, the main.py file is run\nCMD python3 main.py\n</marked-tab>\n')),(0,a.kt)("h2",{id:"-examples"},(0,a.kt)("a",{parentName:"h2",href:"#examples",target:null,rel:null})," Examples"),(0,a.kt)("p",null,"The examples we just showed were for Node.js and Python, however, to drive home the fact that actors can be written in any language, here are some examples of some Dockerfiles for actors written in different programming languages:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-marked-tabs"},'<marked-tab header="GO actor Dockerfile" lang="Dockerfile">\nFROM golang:1.17.1-alpine\n\nWORKDIR /app\nCOPY . .\n\nRUN go mod download\n\nRUN go build -o /example-actor\nCMD ["/example-actor"]\n</marked-tab>\n<marked-tab header="Rust actor Dockerfile" lang="Dockerfile">\n# Image with prebuilt Rust. We use the newest 1.* version\n# https://hub.docker.com/_/rust\nFROM rust:1\n\n# We copy only package setup so we cache building all dependencies\nCOPY Cargo* ./\n\n# We need to have dummy main.rs file to be able to build\nRUN mkdir src && echo "fn main() {}" > src/main.rs\n\n# Build dependencies only\n# Since we do this before copying  the rest of the files,\n# the dependencies will be cached by Docker, allowing fast\n# build times for new code changes\nRUN cargo build --release\n\n# Delete dummy main.rs\nRUN rm -rf src\n\n# Copy rest of the files\nCOPY . ./\n\n# Build the source files\nRUN cargo build --release\n\nCMD ["./target/release/actor-example"]\n</marked-tab>\n<marked-tab header="Julia actor Dockerfile" lang="Dockerfile">\nFROM julia:1.7.1-alpine\n\nWORKDIR /app\nCOPY . .\n\nRUN julia install.jl\n\nCMD ["julia", "main.jl"]\n</marked-tab>\n')),(0,a.kt)("h2",{id:"-next-up"},(0,a.kt)("a",{parentName:"h2",href:"#next",target:null,rel:null})," Next up"),(0,a.kt)("p",null,"In the ",(0,a.kt)("a",{parentName:"p",href:"/academy/deploying-your-code/deploying",target:null,rel:null},"next lesson"),", we'll be push our code directly to the Apify platform, or create and integrate a new actor on the Apify platform with our project's GitHub repository."))}f.isMDXComponent=!0}}]);