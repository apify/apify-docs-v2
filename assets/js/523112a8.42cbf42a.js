"use strict";(self.webpackChunkapify_docs_v2=self.webpackChunkapify_docs_v2||[]).push([[491],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=p(n),h=o,m=c["".concat(s,".").concat(h)]||c[h]||d[h]||r;return n?a.createElement(m,i(i({ref:t},u),{},{components:n})):a.createElement(m,i({ref:t},u))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[c]="string"==typeof e?e:o,i[1]=l;for(var p=2;p<r;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},12715:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>s,default:()=>h,frontMatter:()=>l,metadata:()=>p,toc:()=>c});var a=n(87462),o=n(63366),r=(n(67294),n(3905)),i=["components"],l={title:"Scraping with Puppeteer Scraper",menuTitle:"Puppeteer Scraper",description:"Learn how to scrape a website using Apify's Puppeteer Scraper. Build an actor's page function, extract information from a web page and download your data.",externalSourceUrl:"https://raw.githubusercontent.com/apifytech/actor-scraper/master/docs/build/puppeteer-scraper-tutorial.md",sidebar_position:4,slug:"/tutorials/apify-scrapers/puppeteer-scraper"},s=void 0,p={unversionedId:"tutorials/apify_scrapers/puppeteer_scraper",id:"tutorials/apify_scrapers/puppeteer_scraper",title:"Scraping with Puppeteer Scraper",description:"Learn how to scrape a website using Apify's Puppeteer Scraper. Build an actor's page function, extract information from a web page and download your data.",source:"@site/sources/platform/tutorials/apify_scrapers/puppeteer_scraper.md",sourceDirName:"tutorials/apify_scrapers",slug:"/tutorials/apify-scrapers/puppeteer-scraper",permalink:"/platform/tutorials/apify-scrapers/puppeteer-scraper",draft:!1,tags:[],version:"current",lastUpdatedBy:"Jind\u0159ich B\xe4r",lastUpdatedAt:1671543152,formattedLastUpdatedAt:"Dec 20, 2022",sidebarPosition:4,frontMatter:{title:"Scraping with Puppeteer Scraper",menuTitle:"Puppeteer Scraper",description:"Learn how to scrape a website using Apify's Puppeteer Scraper. Build an actor's page function, extract information from a web page and download your data.",externalSourceUrl:"https://raw.githubusercontent.com/apifytech/actor-scraper/master/docs/build/puppeteer-scraper-tutorial.md",sidebar_position:4,slug:"/tutorials/apify-scrapers/puppeteer-scraper"},sidebar:"defaultSidebar",previous:{title:"Scraping with Cheerio Scraper",permalink:"/platform/tutorials/apify-scrapers/cheerio-scraper"},next:{title:"Building public actors",permalink:"/platform/tutorials/building-public-actors"}},u={},c=[{value:" Getting to know our tools",id:"-getting-to-know-our-tools",level:2},{value:" Web Scraper differences",id:"-web-scraper-differences",level:3},{value:" Building our Page function",id:"-building-our-page-function",level:2},{value:" Title",id:"-title",level:3},{value:" Description",id:"-description",level:3},{value:" Modified date",id:"-modified-date",level:3},{value:" Run count",id:"-run-count",level:3},{value:" Wrapping it up",id:"-wrapping-it-up",level:3},{value:" Test run",id:"-test-run",level:3},{value:" Pagination",id:"-pagination",level:2},{value:" Waiting for dynamic content",id:"-waiting-for-dynamic-content",level:3},{value:"The <code>context.page.waitFor()</code> function",id:"the-contextpagewaitfor-function",level:4},{value:"  How to paginate",id:"--how-to-paginate",level:3},{value:"Waiting for the button",id:"waiting-for-the-button",level:4},{value:"Clicking the button",id:"clicking-the-button",level:4},{value:"Repeating the process",id:"repeating-the-process",level:4},{value:" Plugging it into the Page function",id:"-plugging-it-into-the-page-function",level:3},{value:" Downloading the scraped data",id:"-downloading-the-scraped-data",level:2},{value:" Clean items",id:"-clean-items",level:3},{value:" Bonus: Making your code neater",id:"-bonus-making-your-code-neater",level:2},{value:"  Bonus 2: Using jQuery with Puppeteer Scraper",id:"--bonus-2-using-jquery-with-puppeteer-scraper",level:2},{value:" Injecting jQuery",id:"-injecting-jquery",level:3},{value:" Final word",id:"-final-word",level:2},{value:" What&#39;s next?",id:"-whats-next",level:2}],d={toc:c};function h(e){var t=e.components,n=(0,o.Z)(e,i);return(0,r.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:""}),(0,r.kt)("p",null,"This scraping tutorial will go into the nitty gritty details of extracting data from ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("a",{parentName:"strong",href:"https://apify.com/store",target:"_blank",rel:"noopener"},"https://apify.com/store")),"\nusing ",(0,r.kt)("strong",{parentName:"p"},"Puppeteer Scraper")," (",(0,r.kt)("a",{parentName:"p",href:"https://apify.com/apify/puppeteer-scraper",target:"_blank",rel:"noopener"},"apify/puppeteer-scraper"),"). If you arrived here from the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.apify.com/tutorials/apify-scrapers/getting-started",target:"_blank",rel:"noopener"},"Getting started with Apify scrapers"),",\ntutorial, great! You are ready to continue where we left off. If you haven't seen the Getting started yet,\ncheck it out, it will help you learn about Apify and scraping in general and set you up for this tutorial,\nbecause this one builds on topics and code examples discussed there."),(0,r.kt)("h2",{id:"-getting-to-know-our-tools"},(0,r.kt)("a",{parentName:"h2",href:"#getting-to-know-our-tools",target:null,rel:null})," Getting to know our tools"),(0,r.kt)("p",null,"In the ",(0,r.kt)("a",{parentName:"p",href:"https://apify.com/docs/scraping/tutorial/introduction",target:"_blank",rel:"noopener"},"Getting started with Apify scrapers")," tutorial, we've confirmed that the scraper works as expected,\nso now it's time to add more data to the results."),(0,r.kt)("p",null,"To do that, we'll be using the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/GoogleChrome/puppeteer",target:"_blank",rel:"noopener"},"Puppeteer library"),". Puppeteer is a browser\nautomation library that allows you to control a browser using JavaScript. That is, simulate a real human sitting\nin front of a computer, using a mouse and a keyboard. It gives you almost unlimited possibilities, but you need to learn\nquite a lot before you'll be able to use all of its features. We'll walk you through some of the basics of Puppeteer,\nso that you can start using it for some of the most typical scraping tasks, but if you really want to master it,\nyou'll need to visit its ",(0,r.kt)("a",{parentName:"p",href:"https://pptr.dev/",target:"_blank",rel:"noopener"},"documentation")," and really dive deep into its intricacies."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"The purpose of Puppeteer Scraper is to remove some of the difficulty faced when using Puppeteer by wrapping\nit in a nice, manageable UI. It provides almost all of its features in a format that is much easier to grasp\nwhen first trying to scrape using Puppeteer.")),(0,r.kt)("h3",{id:"-web-scraper-differences"},(0,r.kt)("a",{parentName:"h3",href:"#web-scraper-differences",target:null,rel:null})," Web Scraper differences"),(0,r.kt)("p",null,"At first glance, it may seem like ",(0,r.kt)("strong",{parentName:"p"},"Web Scraper")," (",(0,r.kt)("a",{parentName:"p",href:"https://apify.com/apify/web-scraper",target:"_blank",rel:"noopener"},"apify/web-scraper"),") and Puppeteer Scraper are almost the same. Well, they are.\nIn fact, Web Scraper uses Puppeteer underneath. The difference is the amount of control they give you.\nWhere Web Scraper only gives you access to in-browser JavaScript and the ",(0,r.kt)("inlineCode",{parentName:"p"},"pageFunction")," is executed\nin the browser context, Puppeteer Scraper's ",(0,r.kt)("inlineCode",{parentName:"p"},"pageFunction")," is executed in Node.js context, giving you\nmuch more freedom to bend the browser to your will. You're the puppeteer and the browser is your puppet.\nIt's also much easier to work with external APIs, databases or the ",(0,r.kt)("a",{parentName:"p",href:"https://sdk.apify.com",target:null,rel:null},"Apify SDK"),"\nin the Node.js context. The tradeoff is simple. Power vs simplicity. Web Scraper is simple,\nPuppeteer Scraper is powerful (and the ",(0,r.kt)("a",{parentName:"p",href:"https://sdk.apify.com",target:null,rel:null},"Apify SDK")," is super-powerful)."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Simply put, Web Scraper's ",(0,r.kt)("inlineCode",{parentName:"p"},"pageFunction")," is just a single\n",(0,r.kt)("a",{parentName:"p",href:"https://pptr.dev/#?product=Puppeteer&show=api-pageevaluatepagefunction-args",target:"_blank",rel:"noopener"},"page.evaluate()")," call.")),(0,r.kt)("p",null,"Now that's out of the way, let's open one of the actor detail pages in the Store, for example the Web Scraper page and use our DevTools-Fu to scrape some data."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"If you're wondering why we're using Web Scraper as an example instead of Puppeteer Scraper,\nit's only because we didn't want to triple the number of screenshots we needed to make. Lazy developers!")),(0,r.kt)("h2",{id:"-building-our-page-function"},(0,r.kt)("a",{parentName:"h2",href:"#building-our-page-function",target:null,rel:null})," Building our Page function"),(0,r.kt)("p",null,"Before we start, let's do a quick recap of the data we chose to scrape:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"URL")," - The URL that goes directly to the actor's detail page."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Unique identifier")," - Such as ",(0,r.kt)("strong",{parentName:"li"},"apify/web-scraper"),"."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Title")," - The title visible in the actor's detail page."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Description")," - The actor's description."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Last modification date")," - When the actor was last modified."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Number of runs")," - How many times the actor was run.")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://raw.githubusercontent.com/apifytech/actor-scraper/master/docs/img/scraping-practice.webp",alt:"$1"})),(0,r.kt)("p",null,"We've already scraped number 1 and 2 in the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.apify.com/tutorials/apify-scrapers/getting-started",target:"_blank",rel:"noopener"},"Getting started with Apify scrapers"),"\ntutorial, so let's get to the next one on the list: title."),(0,r.kt)("h3",{id:"-title"},(0,r.kt)("a",{parentName:"h3",href:"#title",target:null,rel:null})," Title"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://raw.githubusercontent.com/apifytech/actor-scraper/master/docs/img/title.webp",alt:"$1"})),(0,r.kt)("p",null,"By using the element selector tool, we find out that the title is there under an ",(0,r.kt)("inlineCode",{parentName:"p"},"<h1>")," tag, as titles should be.\nMaybe surprisingly, we find that there are actually two ",(0,r.kt)("inlineCode",{parentName:"p"},"<h1>")," tags on the detail page. This should get us thinking.\nIs there any parent element that includes our ",(0,r.kt)("inlineCode",{parentName:"p"},"<h1>")," tag, but not the other ones? Yes, there is! There is a ",(0,r.kt)("inlineCode",{parentName:"p"},"<header>"),"\nelement that we can use to select only the heading we're interested in."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Remember that you can press CTRL+F (CMD+F) in the Elements tab of DevTools to open the search bar where you can quickly search for elements using\ntheir selectors. And always make sure to use the DevTools to verify your scraping process and assumptions. It's faster than changing the crawler\ncode all the time.")),(0,r.kt)("p",null,"To get the title we just need to find it using a ",(0,r.kt)("inlineCode",{parentName:"p"},"header h1")," selector, which selects all ",(0,r.kt)("inlineCode",{parentName:"p"},"<h1>")," elements that have a ",(0,r.kt)("inlineCode",{parentName:"p"},"<header>")," ancestor.\nAnd as we already know, there's only one."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// Using Puppeteer\nconst title = await page.$eval(\n    'header h1',\n    (el => el.textContent)\n);\n\nreturn {\n    title,\n}\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"https://pptr.dev/#?product=Puppeteer&show=api-elementhandleevalselector-pagefunction-args-1",target:"_blank",rel:"noopener"},(0,r.kt)("inlineCode",{parentName:"a"},"page.$eval")),"\nfunction allows you to run a function in the browser, with the selected element as the first argument.\nHere we use it to extract the text content of a ",(0,r.kt)("inlineCode",{parentName:"p"},"h1")," element that's in the page. The return value of the function\nis automatically passed back to the Node.js context, so we receive an actual ",(0,r.kt)("inlineCode",{parentName:"p"},"string")," with the element's text."),(0,r.kt)("h3",{id:"-description"},(0,r.kt)("a",{parentName:"h3",href:"#description",target:null,rel:null})," Description"),(0,r.kt)("p",null,"Getting the actor's description is a little more involved, but still pretty straightforward. We can't just simply search for a ",(0,r.kt)("inlineCode",{parentName:"p"},"<p>")," tag, because\nthere's a lot of them in the page. We need to narrow our search down a little. Using the DevTools we find that the actor description is nested within\nthe ",(0,r.kt)("inlineCode",{parentName:"p"},"<header>")," element too, same as the title. Moreover, the actual description is nested inside a ",(0,r.kt)("inlineCode",{parentName:"p"},"<span>")," tag with a class ",(0,r.kt)("inlineCode",{parentName:"p"},"actor-description"),"."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://raw.githubusercontent.com/apifytech/actor-scraper/master/docs/img/description.webp",alt:"$1"})),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const title = await page.$eval(\n    'header h1',\n    (el => el.textContent)\n);\nconst description = await page.$eval(\n    'header span.actor-description',\n    (el => el.textContent)\n);\n\nreturn {\n    title,\n    description\n};\n")),(0,r.kt)("h3",{id:"-modified-date"},(0,r.kt)("a",{parentName:"h3",href:"#modified-date",target:null,rel:null})," Modified date"),(0,r.kt)("p",null,"The DevTools tell us that the ",(0,r.kt)("inlineCode",{parentName:"p"},"modifiedDate")," can be found in a ",(0,r.kt)("inlineCode",{parentName:"p"},"<time>")," element."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://raw.githubusercontent.com/apifytech/actor-scraper/master/docs/img/modified-date.webp",alt:"$1"})),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const title = await page.$eval(\n    'header h1',\n    (el => el.textContent)\n);\nconst description = await page.$eval(\n    'header span.actor-description',\n    (el => el.textContent)\n);\n\nconst modifiedTimestamp = await page.$eval(\n    'ul.ActorHeader-stats time',\n    (el) => el.getAttribute('datetime')\n);\nconst modifiedDate = new Date(Number(modifiedTimestamp));\n\nreturn {\n    title,\n    description,\n    modifiedDate,\n};\n")),(0,r.kt)("p",null,"Similarly to ",(0,r.kt)("inlineCode",{parentName:"p"},"page.$eval"),", the ",(0,r.kt)("a",{parentName:"p",href:"https://pptr.dev/#?product=Puppeteer&show=api-elementhandleevalselector-pagefunction-args",target:"_blank",rel:"noopener"},(0,r.kt)("inlineCode",{parentName:"a"},"page.$$eval")),"\nfunction runs a function in the browser, only this time, it does not provide\nyou with a single ",(0,r.kt)("inlineCode",{parentName:"p"},"Element")," as the function's argument, but rather with an ",(0,r.kt)("inlineCode",{parentName:"p"},"Array")," of ",(0,r.kt)("inlineCode",{parentName:"p"},"Elements"),". Once again,\nthe return value of the function will be passed back to the Node.js context."),(0,r.kt)("p",null,"It might look a little too complex at first glance, but let us walk you through it. We find all the ",(0,r.kt)("inlineCode",{parentName:"p"},"<time>")," elements. Then, we read its ",(0,r.kt)("inlineCode",{parentName:"p"},"datetime")," attribute, because that's where a unix timestamp is stored as a ",(0,r.kt)("inlineCode",{parentName:"p"},"string"),"."),(0,r.kt)("p",null,"But we would much rather see a readable date in our results, not a unix timestamp, so we need to convert it. Unfortunately the ",(0,r.kt)("inlineCode",{parentName:"p"},"new Date()"),"\nconstructor will not accept a ",(0,r.kt)("inlineCode",{parentName:"p"},"string"),", so we cast the ",(0,r.kt)("inlineCode",{parentName:"p"},"string")," to a ",(0,r.kt)("inlineCode",{parentName:"p"},"number")," using the ",(0,r.kt)("inlineCode",{parentName:"p"},"Number()")," function before actually calling ",(0,r.kt)("inlineCode",{parentName:"p"},"new Date()"),".\nPhew!"),(0,r.kt)("h3",{id:"-run-count"},(0,r.kt)("a",{parentName:"h3",href:"#run-count",target:null,rel:null})," Run count"),(0,r.kt)("p",null,"And so we're finishing up with the ",(0,r.kt)("inlineCode",{parentName:"p"},"runCount"),". There's no specific element like ",(0,r.kt)("inlineCode",{parentName:"p"},"<time>"),", so we need to create\na complex selector and then do a transformation on the result."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const title = await page.$eval(\n    'header h1',\n    (el => el.textContent)\n);\nconst description = await page.$eval(\n    'header span.actor-description',\n    (el => el.textContent)\n);\n\nconst modifiedTimestamp = await page.$eval(\n    'ul.ActorHeader-stats time',\n    (el) => el.getAttribute('datetime')\n);\nconst modifiedDate = new Date(Number(modifiedTimestamp));\n\nconst runCountText = await page.$eval(\n    'ul.ActorHeader-stats > li:nth-of-type(3)',\n    (el => el.textContent)\n);\nconst runCount = Number(runCountText.match(/[\\d,]+/)[0].replace(',', ''));\n\nreturn {\n    title,\n    description,\n    modifiedDate,\n    runCount,\n};\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"ul.ActorHeader-stats > li:nth-of-type(3)")," looks complicated, but it only reads that we're looking for a ",(0,r.kt)("inlineCode",{parentName:"p"},'<ul class="ActorHeader-stats ...">')," element and within that\nelement we're looking for the third ",(0,r.kt)("inlineCode",{parentName:"p"},"<li>")," element. We grab its text, but we're only interested in the number of runs. So we parse the number out\nusing a regular expression, but its type is still a ",(0,r.kt)("inlineCode",{parentName:"p"},"string"),", so we finally convert the result to a ",(0,r.kt)("inlineCode",{parentName:"p"},"number")," by wrapping it with a ",(0,r.kt)("inlineCode",{parentName:"p"},"Number()")," call."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"The numbers are formatted with commas as thousands separators (e.g. ",(0,r.kt)("inlineCode",{parentName:"p"},"'1,234,567'"),"), so to extract it, we\nfirst use regular expression ",(0,r.kt)("inlineCode",{parentName:"p"},"/[\\d,]+/")," - it will search for consecutive number or comma characters.\nThen we extract the match via ",(0,r.kt)("inlineCode",{parentName:"p"},".match(/[\\d,]+/)[0]")," and finally remove all the commas by calling ",(0,r.kt)("inlineCode",{parentName:"p"},".replace(/,/g, '')"),".\nWe need to use ",(0,r.kt)("inlineCode",{parentName:"p"},"/,/g")," with the global modifier to support large numbers with multiple separators, without it\nwe would replace only the very first occurrence."),(0,r.kt)("p",{parentName:"blockquote"},"This will give us a string (e.g. ",(0,r.kt)("inlineCode",{parentName:"p"},"'1234567'"),") that can be converted via ",(0,r.kt)("inlineCode",{parentName:"p"},"Number")," function.")),(0,r.kt)("h3",{id:"-wrapping-it-up"},(0,r.kt)("a",{parentName:"h3",href:"#wrapping-it-up",target:null,rel:null})," Wrapping it up"),(0,r.kt)("p",null,"And there we have it! All the data we needed in a single object. For the sake of completeness, let's add\nthe properties we parsed from the URL earlier and we're good to go."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const { url } = request;\n\n// ...\n\nconst uniqueIdentifier = url\n    .split('/')\n    .slice(-2)\n    .join('/');\n\nconst title = await page.$eval(\n    'header h1',\n    (el => el.textContent)\n);\nconst description = await page.$eval(\n    'header span.actor-description',\n    (el => el.textContent)\n);\n\nconst modifiedTimestamp = await page.$eval(\n    'ul.ActorHeader-stats time',\n    (el) => el.getAttribute('datetime')\n);\nconst modifiedDate = new Date(Number(modifiedTimestamp));\n\nconst runCountText = await page.$eval(\n    'ul.ActorHeader-stats > li:nth-of-type(3)',\n    (el => el.textContent)\n);\nconst runCount = Number(runCountText.match(/[\\d,]+/)[0].replace(',', ''));\n\nreturn {\n    url,\n    uniqueIdentifier,\n    title,\n    description,\n    modifiedDate,\n    runCount,\n};\n")),(0,r.kt)("p",null,"All we need to do now is add this to our ",(0,r.kt)("inlineCode",{parentName:"p"},"pageFunction"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"async function pageFunction(context) {\n    // page is Puppeteer's page\n    const { request, log, skipLinks, page } = context;\n\n    if (request.userData.label === 'START') {\n        log.info('Store opened!');\n        // Do some stuff later.\n    }\n    if (request.userData.label === 'DETAIL') {\n        const { url } = request;\n        log.info(`Scraping ${url}`);\n        await skipLinks();\n\n        // Do some scraping.\n        const uniqueIdentifier = url\n            .split('/')\n            .slice(-2)\n            .join('/');\n\n        // Get attributes in parallel to speed up the process.\n        const titleP = page.$eval(\n            'header h1',\n            (el) => el.textContent,\n        );\n        const descriptionP = page.$eval(\n            'header span.actor-description',\n            (el) => el.textContent,\n        );\n        const modifiedTimestampP = page.$eval(\n            'ul.ActorHeader-stats time',\n            (el) => el.getAttribute('datetime'),\n        );\n        const runCountTextP = page.$eval(\n            'ul.ActorHeader-stats > li:nth-of-type(3)',\n            (el) => el.textContent,\n        );\n\n        const [\n            title,\n            description,\n            modifiedTimestamp,\n            runCountText,\n        ] = await Promise.all([\n            titleP,\n            descriptionP,\n            modifiedTimestampP,\n            runCountTextP,\n        ]);\n\n        const modifiedDate = new Date(Number(modifiedTimestamp));\n        const runCount = Number(runCountText.match(/[\\d,]+/)[0].replace(',', ''));\n\n        return {\n            url,\n            uniqueIdentifier,\n            title,\n            description,\n            modifiedDate,\n            runCount,\n        };\n    }\n}\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"You have definitely noticed that we changed up the code a little bit. This is because the back and forth communication\nbetween Node.js and browser takes some time and it slows down the scraper. To limit the effect of this, we changed\nall the functions to start at the same time and only wait for all of them to finish at the end. This is called\nconcurrency or parallelism. Unless the functions need to be executed in a specific order, it's often a good idea\nto run them concurrently to speed things up.")),(0,r.kt)("h3",{id:"-test-run"},(0,r.kt)("a",{parentName:"h3",href:"#test-run",target:null,rel:null})," Test run"),(0,r.kt)("p",null,"As always, try hitting that ",(0,r.kt)("strong",{parentName:"p"},"Save & Run")," button  and visit\nthe ",(0,r.kt)("strong",{parentName:"p"},"Dataset")," preview of clean items. You should see a nice table of all the attributes correctly scraped.\nYou nailed it!"),(0,r.kt)("h2",{id:"-pagination"},(0,r.kt)("a",{parentName:"h2",href:"#pagination",target:null,rel:null})," Pagination"),(0,r.kt)("p",null,'Pagination is just a term that represents "going to the next page of results". You may have noticed that we did not\nactually scrape all the actors, just the first page of results. That\'s because to load the rest of the actors,\none needs to click the ',(0,r.kt)("strong",{parentName:"p"},"Show more")," button at the very bottom of the list. This is pagination."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"This is a typical form of JavaScript pagination, sometimes called infinite scroll. Other pages may just use links\nthat take you to the next page. If you encounter those, just make a ",(0,r.kt)("strong",{parentName:"p"},"Pseudo URL")," for those links and they will\nbe automatically enqueued to the request queue. Use a label to let the scraper know what kind of URL it's processing.")),(0,r.kt)("h3",{id:"-waiting-for-dynamic-content"},(0,r.kt)("a",{parentName:"h3",href:"#waiting-for-dynamic-content",target:null,rel:null})," Waiting for dynamic content"),(0,r.kt)("p",null,"Before we talk about paginating, we need to have a quick look at dynamic content. Since Apify Store is a JavaScript\napplication (as many, if not most, modern websites are), the button might not exist in the page when the scraper\nruns the ",(0,r.kt)("inlineCode",{parentName:"p"},"pageFunction"),"."),(0,r.kt)("p",null,"How is this possible? Because the scraper only waits with executing the ",(0,r.kt)("inlineCode",{parentName:"p"},"pageFunction")," for the page to load its HTML.\nIf there's additional JavaScript that modifies the DOM afterwards, the ",(0,r.kt)("inlineCode",{parentName:"p"},"pageFunction")," may execute before this\nJavaScript had the time to run."),(0,r.kt)("p",null,"At first, you may think that the scraper is broken, but it just cannot wait for all the JavaScript in the page\nto finish executing. For a lot of pages, there's always some JavaScript executing or some network requests being made.\nIt would never stop waiting. It is therefore up to you, the programmer, to wait for the elements you need.\nFortunately, we have an easy solution."),(0,r.kt)("h4",{id:"the-contextpagewaitfor-function"},"The ",(0,r.kt)("inlineCode",{parentName:"h4"},"context.page.waitFor()")," function"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"waitFor()")," is a function that's available on the Puppeteer ",(0,r.kt)("inlineCode",{parentName:"p"},"page")," object that's in turn available on\nthe ",(0,r.kt)("inlineCode",{parentName:"p"},"context")," argument of the  ",(0,r.kt)("inlineCode",{parentName:"p"},"pageFunction")," (as you already know from previous chapters). It helps you with,\nwell, waiting for stuff. It accepts either a number of milliseconds to wait, a selector to await in the page,\nor a function to execute. It will stop waiting once the time elapses, the selector appears or the provided function\nreturns ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),"."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"See ",(0,r.kt)("a",{parentName:"p",href:"https://pptr.dev/#?product=Puppeteer&show=api-pagewaitforselectororfunctionortimeout-options-args",target:"_blank",rel:"noopener"},(0,r.kt)("inlineCode",{parentName:"a"},"page.waitFor()")),"\nin the Puppeteer documentation.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'// Waits for 2 seconds.\nawait page.waitFor(2000);\n// Waits until an element with id "my-id" appears in the page.\nawait page.waitFor(\'#my-id\');\n// Waits until a "myObject" variable appears\n// on the window object.\nawait page.waitFor(() => !!window.myObject);\n')),(0,r.kt)("p",null,"The selector may never be found and the function might never return ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),", so the ",(0,r.kt)("inlineCode",{parentName:"p"},"page.waitFor()")," function also has\na timeout. The default is ",(0,r.kt)("inlineCode",{parentName:"p"},"30")," seconds. You can override it by providing an options object as the second parameter,\nwith a ",(0,r.kt)("inlineCode",{parentName:"p"},"timeout")," property."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"await page.waitFor('.bad-class', { timeout: 5000 });\n")),(0,r.kt)("p",null,"With those tools, you should be able to handle any dynamic content the website throws at you."),(0,r.kt)("h3",{id:"--how-to-paginate"},(0,r.kt)("a",{parentName:"h3",href:"#how-to-paginate",target:null,rel:null}),"  How to paginate"),(0,r.kt)("p",null,"With the theory out of the way, this should be pretty easy. The algorithm is a loop:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Wait for the ",(0,r.kt)("strong",{parentName:"li"},"Show more")," button."),(0,r.kt)("li",{parentName:"ol"},"Click it."),(0,r.kt)("li",{parentName:"ol"},"Is there another ",(0,r.kt)("strong",{parentName:"li"},"Show more")," button?",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Yes? Repeat the above. (loop)"),(0,r.kt)("li",{parentName:"ul"},"No? We're done. We have all the actors.")))),(0,r.kt)("h4",{id:"waiting-for-the-button"},"Waiting for the button"),(0,r.kt)("p",null,"Before we can wait for the button, we need to know its unique selector. A quick look in the DevTools tells us\nthat the button's class is some weird randomly generated string, but fortunately, there's an enclosing ",(0,r.kt)("inlineCode",{parentName:"p"},"<div>"),"\nwith a class of ",(0,r.kt)("inlineCode",{parentName:"p"},"show-more"),". Great! Our unique selector:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"div.show-more > button\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Don't forget to confirm our assumption in the DevTools finder tool (CTRL/CMD + F).")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://raw.githubusercontent.com/apifytech/actor-scraper/master/docs/img/waiting-for-the-button.webp",alt:"$1"})),(0,r.kt)("p",null,"Now that we know what to wait for, we just plug it into the ",(0,r.kt)("inlineCode",{parentName:"p"},"waitFor()")," function."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"await page.waitFor('div.show-more > button');\n")),(0,r.kt)("h4",{id:"clicking-the-button"},"Clicking the button"),(0,r.kt)("p",null,"We have a unique selector for the button and we know that it's already rendered in the page. Clicking it is a piece\nof cake. We'll use the Puppeteer ",(0,r.kt)("inlineCode",{parentName:"p"},"page")," again to issue the click. Puppeteer will actually simulate dragging the mouse\nand making a left mouse click in the element."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"await page.click('div.show-more > button');\n")),(0,r.kt)("p",null,"This will show the next page of actors."),(0,r.kt)("h4",{id:"repeating-the-process"},"Repeating the process"),(0,r.kt)("p",null,"We've shown two function calls, but how do we make this work together in the ",(0,r.kt)("inlineCode",{parentName:"p"},"pageFunction"),"?"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"async function pageFunction(context) {\n\n// ...\n\nlet timeout; // undefined\nconst buttonSelector = 'div.show-more > button';\nwhile (true) {\n    log.info('Waiting for the \"Show more\" button.');\n    try {\n        // Default timeout first time.\n        await page.waitFor(buttonSelector, { timeout });\n        // 2 sec timeout after the first.\n        timeout = 2000;\n    } catch (err) {\n        // Ignore the timeout error.\n        log.info('Could not find the \"Show more button\", '\n            + 'we\\'ve reached the end.');\n        break;\n    }\n    log.info('Clicking the \"Show more\" button.');\n    await page.click(buttonSelector);\n}\n\n// ...\n\n}\n")),(0,r.kt)("p",null,"We want to run this until the ",(0,r.kt)("inlineCode",{parentName:"p"},"waitFor()")," function throws, so that's why we use a ",(0,r.kt)("inlineCode",{parentName:"p"},"while(true)")," loop. We're also not\ninterested in the error, because we're expecting it, so we just ignore it and print a log message instead."),(0,r.kt)("p",null,"You might be wondering what's up with the ",(0,r.kt)("inlineCode",{parentName:"p"},"timeout"),". Well, for the first page load, we want to wait longer,\nso that all the page's JavaScript has had a chance to execute, but for the other iterations, the JavaScript is\nalready loaded and we're just waiting for the page to re-render so waiting for ",(0,r.kt)("inlineCode",{parentName:"p"},"2")," seconds is enough to confirm\nthat the button is not there. We don't want to stall the scraper for ",(0,r.kt)("inlineCode",{parentName:"p"},"30")," seconds just to make sure that there's\nno button."),(0,r.kt)("h3",{id:"-plugging-it-into-the-page-function"},(0,r.kt)("a",{parentName:"h3",href:"#pagination-page-function",target:null,rel:null})," Plugging it into the Page function"),(0,r.kt)("p",null,"We've got the general algorithm ready, so all that's left is to integrate it into our earlier ",(0,r.kt)("inlineCode",{parentName:"p"},"pageFunction"),".\nRemember the ",(0,r.kt)("inlineCode",{parentName:"p"},"// Do some stuff later")," comment? Let's replace it."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"async function pageFunction(context) {\n    const { request, log, skipLinks, page } = context;\n    if (request.userData.label === 'START') {\n        log.info('Store opened!');\n        let timeout; // undefined\n        const buttonSelector = 'div.show-more > button';\n        while (true) {\n            log.info('Waiting for the \"Show more\" button.');\n            try {\n                // Default timeout first time.\n                await page.waitFor(buttonSelector, { timeout });\n                // 2 sec timeout after the first.\n                timeout = 2000;\n            } catch (err) {\n                // Ignore the timeout error.\n                log.info('Could not find the \"Show more button\", '\n                    + 'we\\'ve reached the end.');\n                break;\n            }\n            log.info('Clicking the \"Show more\" button.');\n            await page.click(buttonSelector);\n        }\n    }\n\n    if (request.userData.label === 'DETAIL') {\n        const { url } = request;\n        log.info(`Scraping ${url}`);\n        await skipLinks();\n\n        // Do some scraping.\n        const uniqueIdentifier = url\n            .split('/')\n            .slice(-2)\n            .join('/');\n\n        // Get attributes in parallel to speed up the process.\n        const titleP = page.$eval(\n            'header h1',\n            (el) => el.textContent,\n        );\n        const descriptionP = page.$eval(\n            'header span.actor-description',\n            (el) => el.textContent,\n        );\n        const modifiedTimestampP = page.$eval(\n            'ul.ActorHeader-stats time',\n            (el) => el.getAttribute('datetime'),\n        );\n        const runCountTextP = page.$eval(\n            'ul.ActorHeader-stats > li:nth-of-type(3)',\n            (el) => el.textContent,\n        );\n\n        const [\n            title,\n            description,\n            modifiedTimestamp,\n            runCountText,\n        ] = await Promise.all([\n            titleP,\n            descriptionP,\n            modifiedTimestampP,\n            runCountTextP,\n        ]);\n\n        const modifiedDate = new Date(Number(modifiedTimestamp));\n        const runCount = Number(runCountText.match(/[\\d,]+/)[0].replace(',', ''));\n\n        return {\n            url,\n            uniqueIdentifier,\n            title,\n            description,\n            modifiedDate,\n            runCount,\n        };\n    }\n}\n")),(0,r.kt)("p",null,"That's it! You can now remove the ",(0,r.kt)("strong",{parentName:"p"},"Max pages per run")," limit, ",(0,r.kt)("strong",{parentName:"p"},"Save & Run")," your task and watch the scraper paginate\nthrough all the actors and then scrape all of their data. After it succeeds, open the ",(0,r.kt)("strong",{parentName:"p"},"Dataset")," tab again click on ",(0,r.kt)("strong",{parentName:"p"},"Preview"),". You should have a table of all the actor's details in front of you. If you do, great job!\nYou've successfully scraped Apify Store. And if not, no worries, just go through the code examples again,\nit's probably just some typo."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://raw.githubusercontent.com/apifytech/actor-scraper/master/docs/img/plugging-it-into-the-pagefunction.webp",alt:"$1"})),(0,r.kt)("h2",{id:"-downloading-the-scraped-data"},(0,r.kt)("a",{parentName:"h2",href:"#downloading-our-scraped-data",target:null,rel:null})," Downloading the scraped data"),(0,r.kt)("p",null,"You already know the ",(0,r.kt)("strong",{parentName:"p"},"Dataset")," tab of the run console since this is where we've always previewed our data. Notice the row of data formats such as JSON, CSV, and Excel. Below it are options for viewing and downloading the data. Go ahead and try it."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"If you prefer working with an API, you can find the example endpoint under the API tab: ",(0,r.kt)("strong",{parentName:"p"},"Get dataset items"),".")),(0,r.kt)("h3",{id:"-clean-items"},(0,r.kt)("a",{parentName:"h3",href:"#clean-items",target:null,rel:null})," Clean items"),(0,r.kt)("p",null,"You can view and download your data without modifications, or you can choose to only get ",(0,r.kt)("strong",{parentName:"p"},"clean")," items. Data that aren't cleaned include a record\nfor each ",(0,r.kt)("inlineCode",{parentName:"p"},"pageFunction")," invocation, even if you did not return any results. The record also includes hidden fields\nsuch as ",(0,r.kt)("inlineCode",{parentName:"p"},"#debug"),", where you can find a variety of information that can help you with debugging your scrapers."),(0,r.kt)("p",null,"Clean items, on the other hand, include only the data you returned from the ",(0,r.kt)("inlineCode",{parentName:"p"},"pageFunction"),". If you're only interested in the data you scraped, this format is what you will be using most of the time."),(0,r.kt)("p",null,"To control this, open the ",(0,r.kt)("strong",{parentName:"p"},"Advanced options")," view on the ",(0,r.kt)("strong",{parentName:"p"},"Dataset")," tab."),(0,r.kt)("h2",{id:"-bonus-making-your-code-neater"},(0,r.kt)("a",{parentName:"h2",href:"#bonus-making-your-code-neater",target:null,rel:null})," Bonus: Making your code neater"),(0,r.kt)("p",null,"You may have noticed that the ",(0,r.kt)("inlineCode",{parentName:"p"},"pageFunction")," gets quite bulky. To make better sense of your code and have an easier\ntime maintaining or extending your task, feel free to define other functions inside the ",(0,r.kt)("inlineCode",{parentName:"p"},"pageFunction"),"\nthat encapsulate all the different logic. You can, for example, define a function for each of the different pages:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"async function pageFunction(context) {\n    switch (context.request.userData.label) {\n        case 'START': return handleStart(context);\n        case 'DETAIL': return handleDetail(context);\n    }\n\n    async function handleStart({ log, page }) {\n        log.info('Store opened!');\n        let timeout; // undefined\n        const buttonSelector = 'div.show-more > button';\n        while (true) {\n            log.info('Waiting for the \"Show more\" button.');\n            try {\n                // Default timeout first time.\n                await page.waitFor(buttonSelector, { timeout });\n                // 2 sec timeout after the first.\n                timeout = 2000;\n            } catch (err) {\n                // Ignore the timeout error.\n                log.info('Could not find the \"Show more button\", '\n                    + 'we\\'ve reached the end.');\n                break;\n            }\n            log.info('Clicking the \"Show more\" button.');\n            await page.click(buttonSelector);\n        }\n    }\n\n    async function handleDetail({\n        request,\n        log,\n        skipLinks,\n        page,\n    }) {\n        const { url } = request;\n        log.info(`Scraping ${url}`);\n        await skipLinks();\n\n        // Do some scraping.\n        const uniqueIdentifier = url\n            .split('/')\n            .slice(-2)\n            .join('/');\n\n        // Get attributes in parallel to speed up the process.\n        const titleP = page.$eval(\n            'header h1',\n            (el) => el.textContent,\n        );\n        const descriptionP = page.$eval(\n            'header span.actor-description',\n            (el) => el.textContent,\n        );\n        const modifiedTimestampP = page.$eval(\n            'ul.ActorHeader-stats time',\n            (el) => el.getAttribute('datetime'),\n        );\n        const runCountTextP = page.$eval(\n            'ul.ActorHeader-stats > li:nth-of-type(3)',\n            (el) => el.textContent,\n        );\n\n        const [\n            title,\n            description,\n            modifiedTimestamp,\n            runCountText,\n        ] = await Promise.all([\n            titleP,\n            descriptionP,\n            modifiedTimestampP,\n            runCountTextP,\n        ]);\n\n        const modifiedDate = new Date(Number(modifiedTimestamp));\n        const runCount = Number(runCountText.match(/[\\d,]+/)[0].replace(',', ''));\n\n        return {\n            url,\n            uniqueIdentifier,\n            title,\n            description,\n            modifiedDate,\n            runCount,\n        };\n    }\n}\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"If you're confused by the functions being declared below their executions, it's called hoisting and it's a feature\nof JavaScript. It helps you put what matters on top, if you so desire.")),(0,r.kt)("h2",{id:"--bonus-2-using-jquery-with-puppeteer-scraper"},(0,r.kt)("a",{parentName:"h2",href:"#bonus-2-using-jquery-with-puppeteer-scraper",target:null,rel:null}),"  Bonus 2: Using jQuery with Puppeteer Scraper"),(0,r.kt)("p",null,"If you're familiar with the ",(0,r.kt)("a",{parentName:"p",href:"https://jquery.com/",target:"_blank",rel:"noopener"},"jQuery library"),", you may have looked at the scraping code and thought\nthat it's unnecessarily complicated. That's probably up to everyone to decide on their own, but the good news is,\nyou can easily use jQuery with Puppeteer Scraper too."),(0,r.kt)("h3",{id:"-injecting-jquery"},(0,r.kt)("a",{parentName:"h3",href:"#injecting-jquery",target:null,rel:null})," Injecting jQuery"),(0,r.kt)("p",null,"To be able to use jQuery, we first need to introduce it to the browser. Fortunately, we have a helper function to\ndo just that: ",(0,r.kt)("a",{parentName:"p",href:"https://sdk.apify.com/docs/api/puppeteer#puppeteerinjectjquerypage",target:null,rel:null},(0,r.kt)("inlineCode",{parentName:"a"},"Apify.utils.puppeteer.injectJQuery"))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Just a friendly warning. Injecting jQuery into a page may break the page itself, if it expects a specific version\nof jQuery to be available and you override it with an incompatible one. So, be careful.")),(0,r.kt)("p",null,"You can either call this function directly in your ",(0,r.kt)("inlineCode",{parentName:"p"},"pageFunction"),", or you can set up jQuery injection in the\n",(0,r.kt)("strong",{parentName:"p"},"Pre goto function")," in the ",(0,r.kt)("strong",{parentName:"p"},"Input and options")," section."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"async function pageFunction(context) {\n    const { Apify, page } = context;\n    await Apify.utils.puppeteer.injectJQuery(page);\n\n    // your code ...\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"async function preGotoFunction({ page, Apify }) {\n    await Apify.utils.puppeteer.injectJQuery(page);\n}\n")),(0,r.kt)("p",null,"The implementations are almost equal in effect. That means that in some cases, you may see performance differences,\nor one might work while the other does not. Depending on the target website."),(0,r.kt)("p",null,"Let's try refactoring the Bonus 1 version of the ",(0,r.kt)("inlineCode",{parentName:"p"},"pageFunction")," to use jQuery."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"async function pageFunction(context) {\n    switch (context.request.userData.label) {\n        case 'START': return handleStart(context);\n        case 'DETAIL': return handleDetail(context);\n    }\n\n    async function handleStart({ log, page }) {\n        log.info('Store opened!');\n        let timeout; // undefined\n        const buttonSelector = 'div.show-more > button';\n        while (true) {\n            log.info('Waiting for the \"Show more\" button.');\n            try {\n                await page.waitFor(buttonSelector, { timeout });\n                timeout = 2000;\n            } catch (err) {\n                log.info('Could not find the \"Show more button\", '\n                    + 'we\\'ve reached the end.');\n                break;\n            }\n            log.info('Clicking the \"Show more\" button.');\n            await page.click(buttonSelector);\n        }\n    }\n\n    async function handleDetail(context) {\n        const {\n            request,\n            log,\n            skipLinks,\n            page,\n            Apify,\n        } = context;\n\n        // Inject jQuery\n        await Apify.utils.puppeteer.injectJQuery(page);\n\n        const { url } = request;\n        log.info(`Scraping ${url}`);\n        await skipLinks();\n\n        // Do some scraping.\n        const uniqueIdentifier = url\n            .split('/')\n            .slice(-2)\n            .join('/');\n\n        // Use jQuery only inside page.evaluate (inside browser)\n        const results = await page.evaluate(() => {\n            return {\n                title: $('header h1').text(),\n                description: $('header span.actor-description').text(),\n                modifiedDate: new Date(\n                    Number(\n                        $('ul.ActorHeader-stats time').attr('datetime'),\n                    ),\n                ).toISOString(),\n                runCount: Number(\n                    $('ul.ActorHeader-stats > li:nth-of-type(3)')\n                        .text()\n                        .match(/[\\d,]+/)[0]\n                        .replace(/,/g, ''),\n                ),\n            };\n        });\n\n        return {\n            url,\n            uniqueIdentifier,\n            // Add results from browser to output\n            ...results,\n        };\n    }\n}\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"There's an important takeaway from the example code. You can only use jQuery in the browser scope, even though you're\ninjecting it outside of the browser. We're using the ",(0,r.kt)("a",{parentName:"p",href:"https://pptr.dev/#?product=Puppeteer&show=api-pageevaluatepagefunction-args",target:"_blank",rel:"noopener"},(0,r.kt)("inlineCode",{parentName:"a"},"page.evaluate()")),"\nfunction to run the script in the context of the browser and the return value is passed back to Node.js. Keep this in mind.")),(0,r.kt)("h2",{id:"-final-word"},(0,r.kt)("a",{parentName:"h2",href:"#final-word",target:null,rel:null})," Final word"),(0,r.kt)("p",null,"Thank you for reading this whole tutorial! Really! It's important to us that our users have the best information available to them so that they can use Apify easily and effectively. We're glad that you made it all the way here and congratulations on creating your first scraping task. We hope that you liked the tutorial and if there's anything you'd like to ask, ",(0,r.kt)("a",{parentName:"p",href:"https://discord.gg/jyEM2PRvMU",target:"_blank",rel:"noopener"},"join us on Discord"),"!"),(0,r.kt)("h2",{id:"-whats-next"},(0,r.kt)("a",{parentName:"h2",href:"#whats-next",target:null,rel:null})," What's next?"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Check out the ",(0,r.kt)("a",{parentName:"li",href:"https://sdk.apify.com/",target:null,rel:null},"Apify SDK")," and its ",(0,r.kt)("a",{parentName:"li",href:"https://sdk.apify.com/docs/guides/getting-started",target:null,rel:null},"Getting started")," tutorial if you'd like to try building your own actors. It's a bit more complex and involved than writing a simple ",(0,r.kt)("inlineCode",{parentName:"li"},"pageFunction"),", but it allows you to fine-tune all the details of your scraper to your liking."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.apify.com/actors",target:"_blank",rel:"noopener"},"Take a deep dive into actors"),", from how they work to ",(0,r.kt)("a",{parentName:"li",href:"https://docs.apify.com/actors/publishing",target:"_blank",rel:"noopener"},"publishing")," them in Apify Store, and even ",(0,r.kt)("a",{parentName:"li",href:"https://blog.apify.com/make-regular-passive-income-developing-web-automation-actors-b0392278d085/",target:"_blank",rel:"noopener"},"making money")," on actors."),(0,r.kt)("li",{parentName:"ul"},"Found out you're not into the coding part but would still to use Apify actors? Check out our ",(0,r.kt)("a",{parentName:"li",href:"https://apify.com/store",target:"_blank",rel:"noopener"},"ready-made solutions")," or ",(0,r.kt)("a",{parentName:"li",href:"https://apify.com/custom-solutions",target:"_blank",rel:"noopener"},"order a custom actor")," from an Apify-certified developer.")))}h.isMDXComponent=!0}}]);