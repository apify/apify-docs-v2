name: publish-theme

on:
    push:
        branches:
            - master

jobs:
    publish:
        runs-on: ubuntu-latest

        steps:
            -   uses: actions/checkout@v3
            -   name: Use Node.js 16
                uses: actions/setup-node@v2-beta
                with:
                    node-version: 16

            -   name: Deploy theme to npm
                run: |
                  VERSION_CHANGE=$(git diff HEAD HEAD^ -- $GITHUB_WORKSPACE/theme/package.json | grep \"version\");
                  if [[ -z $VERSION_CHANGE ]]; 
                    then
                        echo "No theme version updates found, closing!";
                    else
                        echo "Theme version updated!";
                        echo "$VERSION_CHANGE";
                        cd $GITHUB_WORKSPACE/theme && npm publish --access=public;
                    fi;
                env:
                    NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
                    GIT_USER: "barjin:${{ secrets.GH_TOKEN }}"
                    GH_TOKEN: ${{ secrets.GH_TOKEN }}
